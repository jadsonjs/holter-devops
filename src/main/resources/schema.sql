
--- CREATE THE H2 SCHEMA


CREATE SCHEMA IF NOT EXISTS "HOLTER" AUTHORIZATION "SA";

CREATE CACHED TABLE "HOLTER"."ACCESS_LOG"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "DATE_TIME" TIMESTAMP(6) NOT NULL,
    "END_P" DATE NOT NULL,
    "INIT_P" DATE NOT NULL,
    "PROJECT_ID" BIGINT NOT NULL,
    "USER_ID" BIGINT,
    "USER_SELECTED_DATA_ID" BIGINT
);

ALTER TABLE "HOLTER"."ACCESS_LOG" ADD CONSTRAINT "HOLTER"."CONSTRAINT_D" PRIMARY KEY("ID");


CREATE CACHED TABLE "HOLTER"."CONTROL_METRIC"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "N_DEVELOPERS" NUMERIC(38, 2) NOT NULL,
    "PROJECT_COMPLEXITY" NUMERIC(38, 2) NOT NULL,
    "PROJECT_SIZE" NUMERIC(38, 2) NOT NULL,
    "TECHNICAL_DEBT" NUMERIC(38, 2) NOT NULL,
    "PERIOD_ID" BIGINT NOT NULL
);

ALTER TABLE "HOLTER"."CONTROL_METRIC" ADD CONSTRAINT "HOLTER"."CONSTRAINT_E" PRIMARY KEY("ID");


CREATE CACHED TABLE "HOLTER"."MAIN_REPOSITORY"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 2) NOT NULL,
    "ISSUES_ERROS_LABELS" CHARACTER VARYING(255),
    "NAME" CHARACTER VARYING(255) NOT NULL,
    "PRODUTION_BRANCH" CHARACTER VARYING(255) NOT NULL,
    "TOKEN" CHARACTER VARYING(255) NOT NULL,
    "URL" CHARACTER VARYING(255) NOT NULL
);

ALTER TABLE "HOLTER"."MAIN_REPOSITORY" ADD CONSTRAINT "HOLTER"."CONSTRAINT_8" PRIMARY KEY("ID");



CREATE CACHED TABLE "HOLTER"."METRIC_HISTORY"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "METRIC" ENUM('BUGS_RATE', 'BUILD_ACTIVITY', 'BUILD_DURATION', 'BUILD_HEALTH', 'CHANGE_FAILURE_RATE', 'COMMENTS_PER_CHANGE', 'COMMIT_PER_DAY', 'COVERAGE', 'CYCLE_TIME', 'DEPLOYMENT_FREQUENCY', 'INFRASTRUCTURE_COSTS', 'LEAD_TIME', 'LEAD_TIME_FOR_CHANGES', 'MEAN_TIME_TO_RECOVERY', 'NUMBER_OF_BUGS', 'NUMBER_OF_CHANGES_DELIVERED', 'NUMBER_OF_CLOSED_ISSUES', 'NUMBER_OF_VULNERABILITIES', 'TIME_TO_FIX_BROKEN_BUILD', 'COMMITS_PER_DEVELOPER', 'APPROVED_MERGE_REQUESTS_PER_DEVELOPER') NOT NULL,
    "METRIC_INFO" CHARACTER VARYING,
    "METRIC_VALUE" NUMERIC(38, 2) NOT NULL,
    "PERIOD_ID" BIGINT NOT NULL,
    "METRIC_SEGMENT_ID" BIGINT
);


ALTER TABLE "HOLTER"."METRIC_HISTORY" ADD CONSTRAINT "HOLTER"."CONSTRAINT_D6" PRIMARY KEY("ID");

CREATE CACHED TABLE "HOLTER"."METRIC_SEGMENT" (
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "TYPE" VARCHAR(255) NOT NULL,
    "IDENTIFIER" VARCHAR(255) NOT NULL,
    "EXTRA_INFO" VARCHAR(255)
);

ALTER TABLE "HOLTER"."METRIC_SEGMENT" ADD CONSTRAINT "HOLTER"."CONSTRAINT_8D" PRIMARY KEY("ID");

CREATE CACHED TABLE "HOLTER"."METRIC_REFERENCE_VALUES"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "METRIC" ENUM('BUGS_RATE', 'BUILD_ACTIVITY', 'BUILD_DURATION', 'BUILD_HEALTH', 'CHANGE_FAILURE_RATE', 'COMMENTS_PER_CHANGE', 'COMMIT_PER_DAY', 'COVERAGE', 'CYCLE_TIME', 'DEPLOYMENT_FREQUENCY', 'INFRASTRUCTURE_COSTS', 'LEAD_TIME', 'LEAD_TIME_FOR_CHANGES', 'MEAN_TIME_TO_RECOVERY', 'NUMBER_OF_BUGS', 'NUMBER_OF_CHANGES_DELIVERED', 'NUMBER_OF_CLOSED_ISSUES', 'NUMBER_OF_VULNERABILITIES', 'TIME_TO_FIX_BROKEN_BUILD', 'COMMITS_PER_DEVELOPER', 'APPROVED_MERGE_REQUESTS_PER_DEVELOPER') NOT NULL,
    "METRIC_VALUE" NUMERIC(38, 2) NOT NULL,
    "PROJECT_ID" BIGINT NOT NULL
);

ALTER TABLE "HOLTER"."METRIC_REFERENCE_VALUES" ADD CONSTRAINT "HOLTER"."CONSTRAINT_7" PRIMARY KEY("ID");



CREATE CACHED TABLE "HOLTER"."PERIOD"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "END_P" TIMESTAMP(6) NOT NULL,
    "INDEX" INTEGER NOT NULL,
    "INIT_P" TIMESTAMP(6) NOT NULL,
    "PROJECT_ID" BIGINT NOT NULL
);

ALTER TABLE "HOLTER"."PERIOD" ADD CONSTRAINT "HOLTER"."CONSTRAINT_8C" PRIMARY KEY("ID");


CREATE CACHED TABLE "HOLTER"."PERMISSION"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ROLE" ENUM('ADMIN', 'DEVELOPER', 'MANAGER'),
    "PROJECT_ID" BIGINT,
    "USER_ID" BIGINT
);
ALTER TABLE "HOLTER"."PERMISSION" ADD CONSTRAINT "HOLTER"."CONSTRAINT_F" PRIMARY KEY("ID");


CREATE CACHED TABLE "HOLTER"."PROJECT"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 2) NOT NULL,
    "ACTIVE" BOOLEAN NOT NULL,
    "NAME" CHARACTER VARYING(255) NOT NULL,
    "ORGANIZATION" CHARACTER VARYING(255) NOT NULL
);
ALTER TABLE "HOLTER"."PROJECT" ADD CONSTRAINT "HOLTER"."CONSTRAINT_1" PRIMARY KEY("ID");


CREATE CACHED TABLE "HOLTER"."PROJECT_CONFIGURATION"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 2) NOT NULL,
    "SECONDARY_REPOSITORY_NAME" CHARACTER VARYING(255),
    "SECONDARY_REPOSITORY_ORGANIZATION" CHARACTER VARYING(255),
    "SECONDARY_REPOSITORY_TOKEN" CHARACTER VARYING(255),
    "SECONDARY_REPOSITORY_URL" CHARACTER VARYING(255),
    "MAIN_REPOSITORY_ID" BIGINT NOT NULL,
    "PROJECT_ID" BIGINT NOT NULL
);

ALTER TABLE "HOLTER"."PROJECT_CONFIGURATION" ADD CONSTRAINT "HOLTER"."CONSTRAINT_A" PRIMARY KEY("ID");



CREATE CACHED TABLE "HOLTER"."SCHEDULER"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "AUTOMATIC" BOOLEAN NOT NULL,
    "FREQUENCY" TINYINT NOT NULL,
    "LAST_EXECUTION" TIMESTAMP(6),
    "START_EXECUTION" TIMESTAMP(6),
    "PROJECT_ID" BIGINT
);

ALTER TABLE "HOLTER"."SCHEDULER" ADD CONSTRAINT "HOLTER"."CONSTRAINT_9C" PRIMARY KEY("ID");


CREATE CACHED TABLE "HOLTER"."SCHEDULER_COLLECTORS"(
    "SCHEDULER_ID" BIGINT NOT NULL,
    "COLLECTOR_ID" UUID
);



CREATE CACHED TABLE "HOLTER"."USER_"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ALERT" BOOLEAN DEFAULT FALSE NOT NULL,
    "EMAIL" CHARACTER VARYING(255) NOT NULL,
    "PASSWORD" CHARACTER VARYING(255) NOT NULL
);

ALTER TABLE "HOLTER"."USER_" ADD CONSTRAINT "HOLTER"."CONSTRAINT_4" PRIMARY KEY("ID");



ALTER TABLE "HOLTER"."SCHEDULER" ADD CONSTRAINT "HOLTER"."CONSTRAINT_9" CHECK("FREQUENCY" BETWEEN 0 AND 2) NOCHECK;
ALTER TABLE "HOLTER"."PROJECT_CONFIGURATION" ADD CONSTRAINT "HOLTER"."UKFSERYS4SC7K295W86ERAINWLV" UNIQUE("PROJECT_ID");
ALTER TABLE "HOLTER"."USER_" ADD CONSTRAINT "HOLTER"."UKHA67CVLHY4NK1PRSWL5GJ1Y0Y" UNIQUE("EMAIL");
ALTER TABLE "HOLTER"."CONTROL_METRIC" ADD CONSTRAINT "HOLTER"."FK5ISIT80VCY1AJWEPODIYLESYY" FOREIGN KEY("PERIOD_ID") REFERENCES "HOLTER"."PERIOD"("ID") NOCHECK;
ALTER TABLE "HOLTER"."METRIC_REFERENCE_VALUES" ADD CONSTRAINT "HOLTER"."FK3XVQAHE6TP9NTQ4WVNY4AUQHK" FOREIGN KEY("PROJECT_ID") REFERENCES "HOLTER"."PROJECT"("ID") NOCHECK;
ALTER TABLE "HOLTER"."ACCESS_LOG" ADD CONSTRAINT "HOLTER"."FKA4AHYMBIPMMDM8X2T2ORFHPY9" FOREIGN KEY("PROJECT_ID") REFERENCES "HOLTER"."PROJECT"("ID") NOCHECK;
ALTER TABLE "HOLTER"."PERMISSION" ADD CONSTRAINT "HOLTER"."FKB0UBHE0QIQD6ER95WWHGUINCU" FOREIGN KEY("PROJECT_ID") REFERENCES "HOLTER"."PROJECT"("ID") NOCHECK;
ALTER TABLE "HOLTER"."PERIOD" ADD CONSTRAINT "HOLTER"."FKEJ48148FGIHOW4IXQUEEHF9YV" FOREIGN KEY("PROJECT_ID") REFERENCES "HOLTER"."PROJECT"("ID") NOCHECK;
ALTER TABLE "HOLTER"."ACCESS_LOG" ADD CONSTRAINT "HOLTER"."FK4SD8MVN321954ONF6X7IW3IVE" FOREIGN KEY("USER_SELECTED_DATA_ID") REFERENCES "HOLTER"."USER_"("ID") NOCHECK;
ALTER TABLE "HOLTER"."PROJECT_CONFIGURATION" ADD CONSTRAINT "HOLTER"."FK83UMOE6VAJ89SL0RXE0Q5GWPD" FOREIGN KEY("MAIN_REPOSITORY_ID") REFERENCES "HOLTER"."MAIN_REPOSITORY"("ID") NOCHECK;
ALTER TABLE "HOLTER"."PERMISSION" ADD CONSTRAINT "HOLTER"."FKR7205M6AJGW6TC2OYWOL8K6FT" FOREIGN KEY("USER_ID") REFERENCES "HOLTER"."USER_"("ID") NOCHECK;
ALTER TABLE "HOLTER"."PROJECT_CONFIGURATION" ADD CONSTRAINT "HOLTER"."FK7VV9KT8IUQIO1AF1EBMJGRG1T" FOREIGN KEY("PROJECT_ID") REFERENCES "HOLTER"."PROJECT"("ID") NOCHECK;
ALTER TABLE "HOLTER"."METRIC_HISTORY" ADD CONSTRAINT "HOLTER"."FKPN9XEOIXV8JBSEB9835DYQFRM" FOREIGN KEY("PERIOD_ID") REFERENCES "HOLTER"."PERIOD"("ID") NOCHECK;
ALTER TABLE "HOLTER"."ACCESS_LOG" ADD CONSTRAINT "HOLTER"."FKLOSX087KP43Y78YM0T4ONI3AF" FOREIGN KEY("USER_ID") REFERENCES "HOLTER"."USER_"("ID") NOCHECK;
ALTER TABLE "HOLTER"."SCHEDULER" ADD CONSTRAINT "HOLTER"."FKDLDS16N9V1H05F63Q9R9R0EVQ" FOREIGN KEY("PROJECT_ID") REFERENCES "HOLTER"."PROJECT"("ID") NOCHECK;
ALTER TABLE "HOLTER"."SCHEDULER_COLLECTORS" ADD CONSTRAINT "HOLTER"."FKH4LB4JS68RKCVPK1MUYR7G43M" FOREIGN KEY("SCHEDULER_ID") REFERENCES "HOLTER"."SCHEDULER"("ID") NOCHECK;
ALTER TABLE "HOLTER"."METRIC_HISTORY" ADD CONSTRAINT "FK_METRIC_HISTORY_SEGMENT" FOREIGN KEY ("METRIC_SEGMENT_ID") REFERENCES "HOLTER"."METRIC_SEGMENT"("ID");











